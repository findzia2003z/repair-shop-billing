<?xml version="1.0" encoding="UTF-8" ?>
<Page
    x:Class="RepairShopBilling.Views.BillHistoryView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="using:RepairShopBilling.Models"
    xmlns:helpers="using:RepairShopBilling.Helpers"
    mc:Ignorable="d"
    Background="{StaticResource DarkGreyBackgroundBrush}">

    <Page.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Assets/Styles/AppStyles.xaml" />
            </ResourceDictionary.MergedDictionaries>
            <helpers:CurrencyConverter x:Key="CurrencyConverter" />
            <helpers:ShortDateConverter x:Key="ShortDateConverter" />
        </ResourceDictionary>
    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Header Image -->
        <Image Grid.Row="0"
               Source="ms-appx:///Assets/Styles/PreviousBills.png"
               HorizontalAlignment="Stretch"
               VerticalAlignment="Top"
               Stretch="Uniform"
               MaxHeight="80"
               Margin="0,0,0,20" />

        <!-- Search Bar -->
        <TextBox 
            Grid.Row="1"
            x:Name="SearchTextBox"
            Text="{x:Bind ViewModel.SearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
            PlaceholderText="Search Name"
            FontSize="18"
            FontWeight="Bold"
            Foreground="#E53E3E"
            Background="White"
            BorderThickness="0"
            CornerRadius="8"
            Padding="16,12"
            HorizontalAlignment="Center"
            Width="400"
            TextAlignment="Center"
            Margin="0,0,0,30" />

        <!-- Bills Grid -->
        <ScrollViewer Grid.Row="2" 
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled">
            <GridView x:Name="BillsGridView"
                      ItemsSource="{x:Bind ViewModel.FilteredBills, Mode=OneWay}"
                      SelectionMode="None"
                      IsItemClickEnabled="False"
                      Padding="0">
                <GridView.ItemsPanel>
                    <ItemsPanelTemplate>
                        <ItemsWrapGrid Orientation="Horizontal" 
                                       ItemWidth="256" 
                                       ItemHeight="126"
                                       MaximumRowsOrColumns="4"
                                       HorizontalAlignment="Center" />
                    </ItemsPanelTemplate>
                </GridView.ItemsPanel>
                <GridView.ItemTemplate>
                    <DataTemplate x:DataType="models:Bill">
                        <Button Background="Transparent"
                                BorderThickness="0"
                                Padding="0"
                                Width="240"
                                Height="110"
                                Margin="8"
                                Command="{Binding DataContext.SelectBillCommand, ElementName=BillsGridView}"
                                CommandParameter="{x:Bind}">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border x:Name="RootBorder"
                                            Background="Black"
                                            CornerRadius="12"
                                            Padding="20,16">
                                        <StackPanel Spacing="4">
                                            <!-- Customer Name -->
                                            <TextBlock Text="{Binding CustomerName}"
                                                       Foreground="White"
                                                       FontFamily="{StaticResource EzraBoldFont}"
                                                       FontSize="18"
                                                       TextTrimming="CharacterEllipsis"
                                                       HorizontalAlignment="Center" />

                                            <!-- Date -->
                                            <TextBlock Text="{Binding Date, Converter={StaticResource ShortDateConverter}}"
                                                       Foreground="#808080"
                                                       FontSize="18"
                                                       HorizontalAlignment="Center"
                                                       Margin="0,4,0,8" />

                                            <!-- Total Amount -->
                                            <StackPanel Orientation="Horizontal"
                                                        HorizontalAlignment="Center"
                                                        Spacing="8">
                                                <TextBlock Text="Total:"
                                                           Foreground="White"
                                                           FontFamily="{StaticResource EzraBoldFont}"
                                                           FontSize="16" />
                                                <TextBlock Text="{Binding TotalAmount, Converter={StaticResource CurrencyConverter}}"
                                                           Foreground="#E53E3E"
                                                           FontFamily="{StaticResource EzraBoldFont}"
                                                           FontSize="16" />
                                            </StackPanel>
                                        </StackPanel>
                                        <VisualStateManager.VisualStateGroups>
                                            <VisualStateGroup x:Name="CommonStates">
                                                <VisualState x:Name="Normal" />
                                                <VisualState x:Name="PointerOver">
                                                    <Storyboard>
                                                        <ObjectAnimationUsingKeyFrames Storyboard.TargetName="RootBorder" Storyboard.TargetProperty="Background">
                                                            <DiscreteObjectKeyFrame KeyTime="0" Value="#1A1A1A" />
                                                        </ObjectAnimationUsingKeyFrames>
                                                    </Storyboard>
                                                </VisualState>
                                                <VisualState x:Name="Pressed">
                                                    <Storyboard>
                                                        <ObjectAnimationUsingKeyFrames Storyboard.TargetName="RootBorder" Storyboard.TargetProperty="Background">
                                                            <DiscreteObjectKeyFrame KeyTime="0" Value="#2A2A2A" />
                                                        </ObjectAnimationUsingKeyFrames>
                                                    </Storyboard>
                                                </VisualState>
                                            </VisualStateGroup>
                                        </VisualStateManager.VisualStateGroups>
                                    </Border>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>
                    </DataTemplate>
                </GridView.ItemTemplate>
            </GridView>
        </ScrollViewer>

        <!-- Empty State -->
        <StackPanel Grid.Row="2"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    Spacing="16"
                    Visibility="{x:Bind ViewModel.IsEmpty, Mode=OneWay}">
            <TextBlock Text="No bills found"
                       Style="{StaticResource EmptyStateTitle}" />
            <TextBlock Text="Bills will appear here once you create them"
                       Style="{StaticResource EmptyStateSubtitle}" />
        </StackPanel>
    </Grid>
</Page>