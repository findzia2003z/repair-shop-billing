<?xml version="1.0" encoding="UTF-8" ?>
<Page
    x:Class="RepairShopBilling.Views.BillViewerView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:helpers="using:RepairShopBilling.Helpers"
    mc:Ignorable="d"
    Background="#1A1A1A">

    <Page.Resources>
        <helpers:CurrencyConverter x:Key="CurrencyConverter" />
        <helpers:ShortDateConverter x:Key="ShortDateConverter" />
        <helpers:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibilityConverter" />
    </Page.Resources>

    <Grid>
        <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
            <StackPanel Margin="0" MaxWidth="650" HorizontalAlignment="Center">
                
                <!-- Company Logo at Top with Black Background -->
                <Border Background="Black" Padding="0,12,0,12">
                    <Image Source="ms-appx:///Assets/Styles/Solid State Dave.png" 
                           Height="38" 
                           HorizontalAlignment="Center" 
                           Stretch="Uniform" />
                </Border>

            <!-- Bill Table Container -->
            <Border CornerRadius="12" Margin="0,0,0,20" BorderThickness="0">
                <StackPanel>
                    
                    <!-- Customer Info Header -->
                    <Border Background="#808080" 
                            CornerRadius="12,12,0,0"
                            Padding="25,12">
                        <Grid>
                            <TextBlock 
                                Text="{x:Bind ViewModel.CurrentBill.CustomerName, Mode=OneWay}"
                                Foreground="White"
                                FontFamily="Segoe UI"
                                FontSize="22"
                                FontWeight="Bold"
                                HorizontalAlignment="Left"
                                VerticalAlignment="Center" />
                            
                            <TextBlock 
                                Text="{x:Bind ViewModel.CurrentBill.Date, Mode=OneWay, Converter={StaticResource ShortDateConverter}}"
                                Foreground="White"
                                FontFamily="Segoe UI"
                                FontSize="22"
                                FontWeight="Bold"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Center" />
                        </Grid>
                    </Border>

                    <!-- Services Table Header -->
                    <Border Background="#E53E3E" Padding="0">
                        <Grid Height="45">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="3" />
                                <ColumnDefinition Width="120" />
                                <ColumnDefinition Width="3" />
                                <ColumnDefinition Width="120" />
                            </Grid.ColumnDefinitions>
                            
                            <!-- Vertical separators -->
                            <Border Grid.Column="1" Background="#333333" />
                            <Border Grid.Column="3" Background="#333333" />
                            
                            <TextBlock 
                                Grid.Column="0"
                                Text="Services"
                                Foreground="Black"
                                FontFamily="Segoe UI"
                                FontSize="18"
                                FontWeight="Bold"
                                VerticalAlignment="Center"
                                Margin="20,0,10,0" />
                            
                            <TextBlock 
                                Grid.Column="2"
                                Text="Amount"
                                Foreground="Black"
                                FontFamily="Segoe UI"
                                FontSize="18"
                                FontWeight="Bold"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center" />
                            
                            <TextBlock 
                                Grid.Column="4"
                                Text="Price"
                                Foreground="Black"
                                FontFamily="Segoe UI"
                                FontSize="18"
                                FontWeight="Bold"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center" />
                        </Grid>
                    </Border>

                    <!-- Services Table Content -->
                    <ItemsControl ItemsSource="{x:Bind ViewModel.CurrentBill.Items, Mode=OneWay}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border BorderBrush="#D0D0D0" 
                                        BorderThickness="0,0,0,1" 
                                        Background="White"
                                        MinHeight="38">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="3" />
                                            <ColumnDefinition Width="120" />
                                            <ColumnDefinition Width="3" />
                                            <ColumnDefinition Width="120" />
                                        </Grid.ColumnDefinitions>
                                        
                                        <!-- Vertical separators -->
                                        <Border Grid.Column="1" Background="#333333" />
                                        <Border Grid.Column="3" Background="#333333" />
                                        
                                        <TextBlock 
                                            Grid.Column="0"
                                            Text="{Binding Description}"
                                            Foreground="#333333"
                                            FontFamily="{StaticResource EzraBoldFont}"
                                            FontSize="15"
                                            VerticalAlignment="Center"
                                            Margin="20,10,10,10" />
                                        
                                        <TextBlock 
                                            Grid.Column="2"
                                            Text="{Binding Quantity}"
                                            Foreground="#333333"
                                            FontFamily="{StaticResource EzraBoldFont}"
                                            FontSize="15"
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Center" />
                                        
                                        <TextBlock 
                                            Grid.Column="4"
                                            Text="{Binding TotalPrice, Converter={StaticResource CurrencyConverter}}"
                                            Foreground="#333333"
                                            FontFamily="{StaticResource EzraBoldFont}"
                                            FontSize="15"
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Center" />
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                    
                    <!-- Total Row -->
                    <Border Background="#808080" 
                            Height="55" 
                            CornerRadius="0,0,12,12">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="243" />
                            </Grid.ColumnDefinitions>
                            
                            <TextBlock 
                                Grid.Column="0"
                                Text="TOTAL"
                                Foreground="White"
                                FontFamily="Segoe UI"
                                FontSize="24"
                                FontWeight="Bold"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center" />
                            
                            <Border Grid.Column="1" 
                                    Background="Black" 
                                    Margin="0" 
                                    CornerRadius="0"
                                    Padding="0">
                                <TextBlock 
                                    Text="{x:Bind ViewModel.CurrentBill.TotalAmount, Mode=OneWay, Converter={StaticResource CurrencyConverter}}"
                                    Foreground="#E53E3E"
                                    FontFamily="Segoe UI"
                                    FontSize="22"
                                    FontWeight="Bold"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center" />
                            </Border>
                        </Grid>
                    </Border>
                </StackPanel>
            </Border>

            <!-- Brain Logo -->
            <Image Source="ms-appx:///Assets/Styles/Logo.png" 
                   Width="200" 
                   Height="200" 
                   HorizontalAlignment="Center"
                   Stretch="Uniform" 
                   Margin="0,10,0,15" />
            
            <!-- Back to Edit Button (only in preview mode) -->
            <Button x:Name="BackToEditButton"
                    Content="← Back to Edit"
                    Background="#E53E3E"
                    Foreground="White"
                    FontSize="16"
                    FontWeight="Bold"
                    Padding="20,10"
                    HorizontalAlignment="Center"
                    Margin="0,10,0,20"
                    Click="OnBackToEditClick"
                    Visibility="{x:Bind ViewModel.IsPreviewMode, Mode=OneWay}" />
            
            <!-- Download and Share Icons with Thank You Text -->
            <Grid HorizontalAlignment="Center" Margin="0,0,0,15">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                
                <!-- Download Icon Button -->
                <Button Grid.Column="0" 
                        Background="Transparent" 
                        BorderThickness="0"
                        Padding="0"
                        Margin="0"
                        VerticalAlignment="Center"
                        Command="{x:Bind ViewModel.GeneratePdfCommand}">
                    <Button.Template>
                        <ControlTemplate TargetType="Button">
                            <Grid Background="Transparent" RenderTransformOrigin="0.5,0.5">
                                <Grid.RenderTransform>
                                    <ScaleTransform x:Name="ScaleTransform" ScaleX="1" ScaleY="1" />
                                </Grid.RenderTransform>
                                <Image x:Name="IconImage"
                                       Source="ms-appx:///Assets/Styles/Download.png" 
                                       Width="100" 
                                       Height="100"
                                       Stretch="Uniform"
                                       Opacity="1" />
                                <VisualStateManager.VisualStateGroups>
                                    <VisualStateGroup x:Name="CommonStates">
                                        <VisualState x:Name="Normal">
                                            <Storyboard>
                                                <DoubleAnimation Storyboard.TargetName="ScaleTransform"
                                                                 Storyboard.TargetProperty="ScaleX"
                                                                 To="1.0" Duration="0:0:0.15" />
                                                <DoubleAnimation Storyboard.TargetName="ScaleTransform"
                                                                 Storyboard.TargetProperty="ScaleY"
                                                                 To="1.0" Duration="0:0:0.15" />
                                                <DoubleAnimation Storyboard.TargetName="IconImage"
                                                                 Storyboard.TargetProperty="Opacity"
                                                                 To="1.0" Duration="0:0:0.15" />
                                            </Storyboard>
                                        </VisualState>
                                        <VisualState x:Name="PointerOver">
                                            <Storyboard>
                                                <DoubleAnimation Storyboard.TargetName="ScaleTransform"
                                                                 Storyboard.TargetProperty="ScaleX"
                                                                 To="1.1" Duration="0:0:0.15" />
                                                <DoubleAnimation Storyboard.TargetName="ScaleTransform"
                                                                 Storyboard.TargetProperty="ScaleY"
                                                                 To="1.1" Duration="0:0:0.15" />
                                                <DoubleAnimation Storyboard.TargetName="IconImage"
                                                                 Storyboard.TargetProperty="Opacity"
                                                                 To="0.8" Duration="0:0:0.15" />
                                            </Storyboard>
                                        </VisualState>
                                        <VisualState x:Name="Pressed">
                                            <Storyboard>
                                                <DoubleAnimation Storyboard.TargetName="ScaleTransform"
                                                                 Storyboard.TargetProperty="ScaleX"
                                                                 To="0.95" Duration="0:0:0.1" />
                                                <DoubleAnimation Storyboard.TargetName="ScaleTransform"
                                                                 Storyboard.TargetProperty="ScaleY"
                                                                 To="0.95" Duration="0:0:0.1" />
                                                <DoubleAnimation Storyboard.TargetName="IconImage"
                                                                 Storyboard.TargetProperty="Opacity"
                                                                 To="0.6" Duration="0:0:0.1" />
                                            </Storyboard>
                                        </VisualState>
                                    </VisualStateGroup>
                                </VisualStateManager.VisualStateGroups>
                            </Grid>
                        </ControlTemplate>
                    </Button.Template>
                </Button>
                
                <!-- Thank You Text -->
                <StackPanel Grid.Column="1" 
                           HorizontalAlignment="Center" 
                           VerticalAlignment="Center"
                           Spacing="1"
                           Margin="45,0">
                    <TextBlock 
                        Text="Thank You"
                        Foreground="#E53E3E"
                        FontFamily="Segoe UI"
                        FontSize="20"
                        FontWeight="Bold"
                        HorizontalAlignment="Center" />
                    
                    <TextBlock 
                        Text="Please Leave A Review On"
                        Foreground="#E53E3E"
                        FontFamily="Segoe UI"
                        FontWeight="Bold"
                        FontSize="20"
                        HorizontalAlignment="Center" />
                    
                    <TextBlock 
                        Text="Google Maps"
                        Foreground="#E53E3E"
                        FontFamily="Segoe UI"
                        FontSize="20"
                        FontWeight="Bold"
                        HorizontalAlignment="Center" />
                </StackPanel>
                
                <!-- Share Icon Button -->
                <Button Grid.Column="2" 
                        Background="Transparent" 
                        BorderThickness="0"
                        Padding="0"
                        Margin="0"
                        VerticalAlignment="Center"
                        Command="{x:Bind ViewModel.ShareBillCommand}">
                    <Button.Template>
                        <ControlTemplate TargetType="Button">
                            <Grid Background="Transparent" RenderTransformOrigin="0.5,0.5">
                                <Grid.RenderTransform>
                                    <ScaleTransform x:Name="ScaleTransform" ScaleX="1" ScaleY="1" />
                                </Grid.RenderTransform>
                                <Image x:Name="IconImage"
                                       Source="ms-appx:///Assets/Styles/Share.png" 
                                       Width="90" 
                                       Height="90"
                                       Stretch="Uniform"
                                       Opacity="1" />
                                <VisualStateManager.VisualStateGroups>
                                    <VisualStateGroup x:Name="CommonStates">
                                        <VisualState x:Name="Normal">
                                            <Storyboard>
                                                <DoubleAnimation Storyboard.TargetName="ScaleTransform"
                                                                 Storyboard.TargetProperty="ScaleX"
                                                                 To="1.0" Duration="0:0:0.15" />
                                                <DoubleAnimation Storyboard.TargetName="ScaleTransform"
                                                                 Storyboard.TargetProperty="ScaleY"
                                                                 To="1.0" Duration="0:0:0.15" />
                                                <DoubleAnimation Storyboard.TargetName="IconImage"
                                                                 Storyboard.TargetProperty="Opacity"
                                                                 To="1.0" Duration="0:0:0.15" />
                                            </Storyboard>
                                        </VisualState>
                                        <VisualState x:Name="PointerOver">
                                            <Storyboard>
                                                <DoubleAnimation Storyboard.TargetName="ScaleTransform"
                                                                 Storyboard.TargetProperty="ScaleX"
                                                                 To="1.1" Duration="0:0:0.15" />
                                                <DoubleAnimation Storyboard.TargetName="ScaleTransform"
                                                                 Storyboard.TargetProperty="ScaleY"
                                                                 To="1.1" Duration="0:0:0.15" />
                                                <DoubleAnimation Storyboard.TargetName="IconImage"
                                                                 Storyboard.TargetProperty="Opacity"
                                                                 To="0.8" Duration="0:0:0.15" />
                                            </Storyboard>
                                        </VisualState>
                                        <VisualState x:Name="Pressed">
                                            <Storyboard>
                                                <DoubleAnimation Storyboard.TargetName="ScaleTransform"
                                                                 Storyboard.TargetProperty="ScaleX"
                                                                 To="0.95" Duration="0:0:0.1" />
                                                <DoubleAnimation Storyboard.TargetName="ScaleTransform"
                                                                 Storyboard.TargetProperty="ScaleY"
                                                                 To="0.95" Duration="0:0:0.1" />
                                                <DoubleAnimation Storyboard.TargetName="IconImage"
                                                                 Storyboard.TargetProperty="Opacity"
                                                                 To="0.6" Duration="0:0:0.1" />
                                            </Storyboard>
                                        </VisualState>
                                    </VisualStateGroup>
                                </VisualStateManager.VisualStateGroups>
                            </Grid>
                        </ControlTemplate>
                    </Button.Template>
                </Button>
            </Grid>
            
            <!-- Footer Image -->
            <Image Source="ms-appx:///Assets/Styles/Footer.png" 
                   HorizontalAlignment="Stretch"
                   VerticalAlignment="Bottom"
                   Stretch="Fill"
                   Margin="0,10,0,0"
                   MaxWidth="650" />
            </StackPanel>
        </ScrollViewer>
        
        <!-- Back Button (Top Left) - Positioned above ScrollViewer -->
        <Button x:Name="BackButton"
                Content="← Back"
                Background="#404040"
                Foreground="White"
                FontFamily="{StaticResource EzraBoldFont}"
                FontSize="18"
                BorderThickness="0"
                Padding="20,12"
                CornerRadius="8"
                HorizontalAlignment="Left"
                VerticalAlignment="Top"
                Margin="20,20,0,0"
                Click="OnBackClick"
                Visibility="{x:Bind ViewModel.IsPreviewMode, Mode=OneWay, Converter={StaticResource InverseBoolToVisibilityConverter}}">
            <Button.Resources>
                <Style TargetType="Button">
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="Button">
                                <Border x:Name="RootBorder"
                                        Background="{TemplateBinding Background}"
                                        CornerRadius="8"
                                        BorderThickness="0">
                                    <ContentPresenter x:Name="ContentPresenter"
                                                      Content="{TemplateBinding Content}"
                                                      Padding="{TemplateBinding Padding}"
                                                      HorizontalContentAlignment="Center"
                                                      VerticalContentAlignment="Center" />
                                    <VisualStateManager.VisualStateGroups>
                                        <VisualStateGroup x:Name="CommonStates">
                                            <VisualState x:Name="Normal" />
                                            <VisualState x:Name="PointerOver">
                                                <Storyboard>
                                                    <ObjectAnimationUsingKeyFrames Storyboard.TargetName="RootBorder" Storyboard.TargetProperty="Background">
                                                        <DiscreteObjectKeyFrame KeyTime="0" Value="#E53E3E" />
                                                    </ObjectAnimationUsingKeyFrames>
                                                </Storyboard>
                                            </VisualState>
                                            <VisualState x:Name="Pressed">
                                                <Storyboard>
                                                    <ObjectAnimationUsingKeyFrames Storyboard.TargetName="RootBorder" Storyboard.TargetProperty="Background">
                                                        <DiscreteObjectKeyFrame KeyTime="0" Value="#CC0000" />
                                                    </ObjectAnimationUsingKeyFrames>
                                                </Storyboard>
                                            </VisualState>
                                        </VisualStateGroup>
                                    </VisualStateManager.VisualStateGroups>
                                </Border>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </Button.Resources>
        </Button>
    </Grid>
</Page>